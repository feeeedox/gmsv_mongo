---
title: Event Logger
description: Track and analyze server events
navigation:
  icon: i-lucide-file-text
---
## Setup
```lua
local logsDB = db:Collection("event_logs")
logsDB:CreateIndex({ timestamp = -1 }, false, "timestamp_desc")
logsDB:CreateIndex({ event_type = 1 }, false, "event_type")
```
## Log Event
```lua
function LogEvent(eventType, data)
    logsDB:InsertOne({
        event_type = eventType,
        data = data,
        timestamp = os.time(),
        server_time = os.date("%Y-%m-%d %H:%M:%S")
    })
end
```
## Track Player Events
```lua
hook.Add("PlayerInitialSpawn", "LogJoin", function(ply)
    LogEvent("player_join", {
        steamid = ply:SteamID(),
        username = ply:Nick(),
        ip = ply:IPAddress()
    })
end)
hook.Add("PlayerDisconnect", "LogLeave", function(ply)
    LogEvent("player_leave", {
        steamid = ply:SteamID(),
        username = ply:Nick()
    })
end)
hook.Add("PlayerDeath", "LogDeath", function(victim, inflictor, attacker)
    LogEvent("player_death", {
        victim = victim:SteamID(),
        attacker = IsValid(attacker) and attacker:SteamID() or "world",
        weapon = IsValid(inflictor) and inflictor:GetClass() or "unknown"
    })
end)
```
## Get Recent Events
```lua
function GetRecentEvents(eventType, limit)
    local filter = {}
    if eventType then
        filter.event_type = eventType
    end
    return logsDB:Aggregate({
        { ["$match"] = filter },
        { ["$sort"] = { timestamp = -1 } },
        { ["$limit"] = limit or 100 }
    })
end
```
## Cleanup Old Logs
```lua
timer.Create("CleanupLogs", 24 * 60 * 60, 0, function()
    local thirtyDaysAgo = os.time() - (30 * 24 * 60 * 60)
    local deleted = logsDB:DeleteMany({
        timestamp = { ["$lt"] = thirtyDaysAgo }
    })
    print("Deleted", deleted, "old logs")
end)
```

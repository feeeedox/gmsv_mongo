---
title: Inventory System
description: Item management and storage
navigation:
  icon: i-lucide-package
---
## Setup
```lua
local inventoryDB = db:Collection("inventories")
inventoryDB:CreateIndex({ steamid = 1 }, true, "steamid_unique")
```
## Initialize Inventory
```lua
function InitInventory(steamid)
    inventoryDB:InsertOne({
        steamid = steamid,
        max_slots = 20,
        items = {},
        created_at = os.time()
    })
end
```
## Add Item
```lua
function AddItem(steamid, itemId, quantity)
    -- Check if exists
    local has = inventoryDB:FindOne({
        steamid = steamid,
        ["items.item_id"] = itemId
    })
    if has then
        -- Increment quantity
        inventoryDB:UpdateOne(
            {
                steamid = steamid,
                ["items.item_id"] = itemId
            },
            {
                ["$inc"] = { ["items.$.quantity"] = quantity }
            }
        )
    else
        -- Add new item
        inventoryDB:UpdateOne(
            { steamid = steamid },
            {
                ["$push"] = {
                    items = {
                        item_id = itemId,
                        quantity = quantity,
                        added_at = os.time()
                    }
                }
            }
        )
    end
end
```
## Remove Item
```lua
function RemoveItem(steamid, itemId, quantity)
    local inv = inventoryDB:FindOne({ steamid = steamid })
    if not inv then return false end
    -- Find current quantity
    local currentQty = 0
    for _, item in ipairs(inv.items) do
        if item.item_id == itemId then
            currentQty = item.quantity
            break
        end
    end
    if currentQty < quantity then
        return false
    end
    if currentQty == quantity then
        -- Remove completely
        inventoryDB:UpdateOne(
            { steamid = steamid },
            { ["$pull"] = { items = { item_id = itemId } } }
        )
    else
        -- Decrease quantity
        inventoryDB:UpdateOne(
            {
                steamid = steamid,
                ["items.item_id"] = itemId
            },
            { ["$inc"] = { ["items.$.quantity"] = -quantity } }
        )
    end
    return true
end
```
## Get Inventory
```lua
function GetInventory(steamid)
    return inventoryDB:FindOne({ steamid = steamid })
end
```

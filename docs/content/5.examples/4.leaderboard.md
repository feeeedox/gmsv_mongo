---
title: Leaderboard System
description: Dynamic rankings and statistics
navigation:
  icon: i-lucide-trophy
---
## Setup
```lua
local leaderboardDB = db:Collection("leaderboard")
leaderboardDB:CreateIndex({ score = -1 }, false, "score_desc")
leaderboardDB:CreateIndex({ steamid = 1 }, true, "steamid_unique")
```
## Update Score
```lua
function UpdateScore(ply, score)
    leaderboardDB:UpdateOne(
        { steamid = ply:SteamID() },
        {
            ["$set"] = {
                username = ply:Nick(),
                score = score,
                updated_at = os.time()
            },
            ["$setOnInsert"] = {
                created_at = os.time()
            }
        },
        true  -- upsert
    )
end
```
## Add Score
```lua
function AddScore(ply, points)
    leaderboardDB:UpdateOne(
        { steamid = ply:SteamID() },
        {
            ["$inc"] = { score = points },
            ["$set"] = { updated_at = os.time() }
        },
        true
    )
end
```
## Get Top Players
```lua
function GetTopPlayers(limit)
    return leaderboardDB:Aggregate({
        { ["$sort"] = { score = -1 } },
        { ["$limit"] = limit or 10 },
        {
            ["$project"] = {
                _id = 0,
                username = 1,
                score = 1
            }
        }
    })
end
```
## Get Player Rank
```lua
function GetRank(steamid)
    local player = leaderboardDB:FindOne({ steamid = steamid })
    if not player then return nil end
    local higherScores = leaderboardDB:Count({
        score = { ["$gt"] = player.score }
    })
    return higherScores + 1
end
```
## Display Leaderboard
```lua
concommand.Add("leaderboard", function(ply)
    local top = GetTopPlayers(10)
    ply:ChatPrint("=== LEADERBOARD ===")
    for i, p in ipairs(top) do
        ply:ChatPrint(string.format("%d. %s - %d pts", 
            i, p.username, p.score))
    end
    local rank = GetRank(ply:SteamID())
    if rank and rank > 10 then
        local data = leaderboardDB:FindOne({ steamid = ply:SteamID() })
        ply:ChatPrint(string.format("\nYour Rank: #%d - %d pts", 
            rank, data.score))
    end
end)
```

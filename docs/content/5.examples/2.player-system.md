---
title: Player System
description: Complete player data management system
navigation:
  icon: i-lucide-user
---
## Setup
```lua
require("mongo")
local client = MongoDB.Client("mongodb://localhost:27017")
local db = client:Database("gameserver")
local playersDB = db:Collection("players")
-- Create indexes
playersDB:CreateIndex({ steamid = 1 }, true, "steamid_unique")
playersDB:CreateIndex({ last_seen = -1 }, false, "last_seen_desc")
```
## Load Player
```lua
hook.Add("PlayerInitialSpawn", "LoadPlayer", function(ply)
    local steamid = ply:SteamID()
    local data = playersDB:FindOne({ steamid = steamid })
    if not data then
        -- New player
        playersDB:InsertOne({
            steamid = steamid,
            username = ply:Nick(),
            first_join = os.time(),
            last_seen = os.time(),
            playtime = 0,
            level = 1,
            credits = 1000,
            inventory = {},
            stats = { kills = 0, deaths = 0 }
        })
    else
        -- Update last seen
        playersDB:UpdateOne(
            { steamid = steamid },
            { 
                ["$set"] = { 
                    last_seen = os.time(),
                    username = ply:Nick()
                }
            }
        )
    end
end)
```
## Track Playtime
```lua
timer.Create("UpdatePlaytime", 60, 0, function()
    for _, ply in ipairs(player.GetAll()) do
        playersDB:UpdateOne(
            { steamid = ply:SteamID() },
            { ["$inc"] = { playtime = 1 } }
        )
    end
end)
```
## Add Credits
```lua
function AddCredits(ply, amount)
    playersDB:UpdateOne(
        { steamid = ply:SteamID() },
        { ["$inc"] = { credits = amount } }
    )
    ply:ChatPrint("You received " .. amount .. " credits!")
end
```
## Get Statistics
```lua
concommand.Add("stats", function(ply)
    local data = playersDB:FindOne({ steamid = ply:SteamID() })
    if data then
        ply:ChatPrint("Level: " .. data.level)
        ply:ChatPrint("Credits: " .. data.credits)
        ply:ChatPrint("Playtime: " .. data.playtime .. " minutes")
    end
end)
```
